(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/room/room"],{247:function(e,o,t){"use strict";(function(e){t(5);n(t(3));var o=n(t(248));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(o.default)}).call(this,t(1)["createPage"])},248:function(e,o,t){"use strict";t.r(o);var n=t(249),r=t(251);for(var s in r)"default"!==s&&function(e){t.d(o,e,(function(){return r[e]}))}(s);t(255);var i,a=t(26),c=Object(a["default"])(r["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],i);c.options.__file="pages/room/room.vue",o["default"]=c.exports},249:function(e,o,t){"use strict";t.r(o);var n=t(250);t.d(o,"render",(function(){return n["render"]})),t.d(o,"staticRenderFns",(function(){return n["staticRenderFns"]})),t.d(o,"recyclableRender",(function(){return n["recyclableRender"]})),t.d(o,"components",(function(){return n["components"]}))},250:function(e,o,t){"use strict";var n;t.r(o),t.d(o,"render",(function(){return r})),t.d(o,"staticRenderFns",(function(){return i})),t.d(o,"recyclableRender",(function(){return s})),t.d(o,"components",(function(){return n}));try{n={trtcRoom:function(){return Promise.all([t.e("common/vendor"),t.e("components/trtc-room/trtc-room")]).then(t.bind(null,409))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,o=e.$createElement;e._self._c},s=!1,i=[];r._withStripped=!0},251:function(e,o,t){"use strict";t.r(o);var n=t(252),r=t.n(n);for(var s in n)"default"!==s&&function(e){t.d(o,e,(function(){return n[e]}))}(s);o["default"]=r.a},252:function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=t(253),r=function(){Promise.all([t.e("common/vendor"),t.e("components/trtc-room/trtc-room")]).then(function(){return resolve(t(409))}.bind(null,t)).catch(t.oe)},s={data:function(){return{rtcConfig:{sdkAppID:"1400584863",userID:"",userSig:"",template:"1v1",enableCamera:!0,enableMic:!0},showTipToast:!1,subscribeList:{}}},components:{trtcRoom:r},props:{},onLoad:function(o){""!=o.consulId&&void 0!=o.consulId&&this.$apis.postListConsultationDetai({id:o.consulId}).then((function(t){e.hideLoading(),200==t.code?t.result.forEach((function(n){"Y"!=t.videoConsult&&e.showModal({title:"提示",content:"未到预约时间或预约订单未支付",success:function(t){t.confirm,e.reLaunch({url:"/pages/expert/consultationDetail?id="+o.consulId})}})})):e.showToast({title:t.msg})})).catch((function(o){e.hideLoading(),console.log(o)})),console.log("room onload",o),e.setKeepScreenOn({keepScreenOn:!0}),this.trtcComponent=this.$refs["trtc-component"],this.bindTRTCRoomEvent(),Object.getOwnPropertyNames(o).forEach((function(e){"true"===o[e]&&(o[e]=!0),"false"===o[e]&&(o[e]=!1)})),this.options=o,this.enterRoom({roomID:Number(o.roomID),userID:o.userID,template:o.template,debugMode:o.debugMode,frontCamera:o.frontCamera,localVideo:o.localVideo,localAudio:o.localAudio,enableEarMonitor:o.enableEarMonitor,enableAutoFocus:o.enableAutoFocus,localMirror:o.localMirror,enableAgc:o.enableAgc,enableAns:o.enableAns,videoHeight:o.videoHeight,videoWidth:o.videoWidth,maxBitrate:Number(o.maxBitrate),minBitrate:Number(o.minBitrate),audioVolumeType:o.audioVolumeType,audioQuality:o.audioQuality,scene:o.scene,encsmall:o.encsmall,cloudenv:o.cloudenv,enableBlackStream:o.enableBlackStream,streamID:o.streamID,userDefineRecordID:o.userDefineRecordID,privateMapKey:o.privateMapKey,pureAudioMode:o.pureAudioMode,recvMode:o.recvMode,enableRecvMessage:o.enableRecvMessage})},onReady:function(){console.log("room ready"),e.setKeepScreenOn({keepScreenOn:!0})},onShow:function(){console.log("room show"),e.setKeepScreenOn({keepScreenOn:!0})},onHide:function(){console.log("room hide")},onUnload:function(){console.log("room unload"),e.setKeepScreenOn({keepScreenOn:!1})},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{enterRoom:function(e){var o=this;e.template=e.template||"1v1",e.roomID=e.roomID||this.randomRoomID(),console.log("打印随机房间号："+e.roomID),e.userID=e.userID||this.randomUserID(),console.log("* room enterRoom",e);var t=(0,n.genTestUserSig)(e.userID);e.sdkAppID=t.sdkAppID,e.userSig=t.userSig,this.template=e.template,"grid"===e.template?this.rtcConfig={sdkAppID:e.sdkAppID,userID:e.userID,userSig:e.userSig,template:e.template,debugMode:e.debugMode,frontCamera:e.frontCamera,enableEarMonitor:e.enableEarMonitor,enableAutoFocus:e.enableAutoFocus,localMirror:e.localMirror,enableAgc:e.enableAgc,enableAns:e.enableAns,videoWidth:e.videoWidth,videoHeight:e.videoHeight,maxBitrate:e.maxBitrate,minBitrate:e.minBitrate,beautyLevel:9,enableIM:!1,audioVolumeType:e.audioVolumeType,audioQuality:e.audioQuality,scene:e.scene,encsmall:e.encsmall?1:0,cloudenv:e.cloudenv,enableBlackStream:e.enableBlackStream,streamID:e.streamID,userDefineRecordID:e.userDefineRecordID,privateMapKey:e.privateMapKey,pureAudioMode:e.pureAudioMode,recvMode:e.recvMode,enableCamera:!0,enableMic:!0}:this.rtcConfig={sdkAppID:e.sdkAppID,userID:e.userID,userSig:e.userSig,template:e.template,debugMode:e.debugMode,beautyLevel:9,enableIM:!1,audioVolumeType:e.audioVolumeType},this.setData({rtcConfig:this.rtcConfig},(function(){o.trtcComponent.enterRoom({roomID:e.roomID}).then((function(){"custom"===o.template&&o.trtcComponent.setViewRect({userID:e.userID,xAxis:"480rpx",yAxis:"160rpx",width:"240rpx",height:"320rpx"})})).catch((function(e){console.error("* room joinRoom 进房失败:",e)}))}))},bindTRTCRoomEvent:function(){var o=this,t=this.trtcComponent.EVENT;this.timestamp=[],this.trtcComponent.on(t.LOCAL_JOIN,(function(e){console.log("* room LOCAL_JOIN",e),!0!==o.options.localVideo&&"1v1"!==o.options.template||o.trtcComponent.publishLocalVideo(),!0!==o.options.localAudio&&"1v1"!==o.options.template||o.trtcComponent.publishLocalAudio(),"custom"===o.options.template&&o.trtcComponent.setViewRect({userID:e.userID,xAxis:"0rpx",yAxis:"0rpx",width:"240rpx",height:"320rpx"})})),this.trtcComponent.on(t.LOCAL_LEAVE,(function(e){console.log("* room LOCAL_LEAVE",e)})),this.trtcComponent.on(t.ERROR,(function(e){console.log("* room ERROR",e)})),this.trtcComponent.on(t.REMOTE_USER_JOIN,(function(t){if(console.log("* room REMOTE_USER_JOIN",t,o.trtcComponent.getRemoteUserList()),o.timestamp.push(new Date),"1v1"===o.template&&o.timestamp.length>1){var n=o.timestamp[1]-o.timestamp[0];n<1e3&&o.setData({showTipToast:!0},(function(){setTimeout((function(){o.setData({showTipToast:!1}),e.navigateBack({delta:1})}),4e3)}))}})),this.trtcComponent.on(t.REMOTE_USER_LEAVE,(function(e){console.log("* room REMOTE_USER_LEAVE",e,o.trtcComponent.getRemoteUserList()),"1v1"===o.template&&(o.timestamp=[]),"1v1"===o.template&&o.remoteUser===e.data.userID&&(o.remoteUser=null)})),this.trtcComponent.on(t.REMOTE_VIDEO_ADD,(function(e){console.log("* room REMOTE_VIDEO_ADD",e,o.trtcComponent.getRemoteUserList());var t=o.trtcComponent.getRemoteUserList(),n=e.data;if("1v1"!==o.template||o.remoteUser&&o.remoteUser!==n.userID?(o.trtcComponent.subscribeRemoteVideo({userID:n.userID,streamType:n.streamType}),o.subscribeList[n.userID+"-video"]=!0):(o.remoteUser=n.userID,o.trtcComponent.subscribeRemoteVideo({userID:n.userID,streamType:n.streamType})),"custom"===o.template&&n.userID&&n.streamType){var r=t.findIndex((function(e){return e.userID===n.userID}));r++;var s=320*r+160;o.trtcComponent.setViewRect({userID:n.userID,streamType:n.streamType,xAxis:"480rpx",yAxis:s+"rpx",width:"240rpx",height:"320rpx"})}})),this.trtcComponent.on(t.REMOTE_VIDEO_REMOVE,(function(e){console.log("* room REMOTE_VIDEO_REMOVE",e,o.trtcComponent.getRemoteUserList())})),this.trtcComponent.on(t.REMOTE_AUDIO_ADD,(function(e){console.log("* room REMOTE_AUDIO_ADD",e,o.trtcComponent.getRemoteUserList());var t=e.data;"1v1"!==o.template||o.remoteUser&&o.remoteUser!==t.userID?(o.trtcComponent.subscribeRemoteAudio({userID:t.userID}),o.subscribeList[t.userID+"-audio"]=!0):(o.remoteUser=t.userID,o.trtcComponent.subscribeRemoteAudio({userID:t.userID}))})),this.trtcComponent.on(t.REMOTE_AUDIO_REMOVE,(function(e){console.log("* room REMOTE_AUDIO_REMOVE",e,o.trtcComponent.getRemoteUserList())})),this.trtcComponent.on(t.IM_READY,(function(e){console.log("* room IM_READY",e)})),this.trtcComponent.on(t.IM_MESSAGE_RECEIVED,(function(e){console.log("* room IM_MESSAGE_RECEIVED",e)}))},randomUserID:function(){return(new Date).getTime().toString(16).split("").reverse().join("")},randomRoomID:function(){return parseInt(9999*Math.random())}}};o.default=s}).call(this,t(1)["default"])},255:function(e,o,t){"use strict";t.r(o);var n=t(256),r=t.n(n);for(var s in n)"default"!==s&&function(e){t.d(o,e,(function(){return n[e]}))}(s);o["default"]=r.a},256:function(e,o,t){}},[[247,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/room/room.js.map