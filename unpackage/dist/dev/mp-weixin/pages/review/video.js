(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/review/video"],{170:function(e,t,o){"use strict";(function(e){o(5);n(o(3));var t=n(o(171));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o(1)["createPage"])},171:function(e,t,o){"use strict";o.r(t);var n=o(172),s=o(174);for(var r in s)"default"!==r&&function(e){o.d(t,e,(function(){return s[e]}))}(r);o(176);var a,c=o(26),i=Object(c["default"])(s["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],a);i.options.__file="pages/review/video.vue",t["default"]=i.exports},172:function(e,t,o){"use strict";o.r(t);var n=o(173);o.d(t,"render",(function(){return n["render"]})),o.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),o.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),o.d(t,"components",(function(){return n["components"]}))},173:function(e,t,o){"use strict";var n;o.r(t),o.d(t,"render",(function(){return s})),o.d(t,"staticRenderFns",(function(){return a})),o.d(t,"recyclableRender",(function(){return r})),o.d(t,"components",(function(){return n}));var s=function(){var e=this,t=e.$createElement;e._self._c},r=!1,a=[];s._withStripped=!0},174:function(e,t,o){"use strict";o.r(t);var n=o(175),s=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=s.a},175:function(e,t,o){"use strict";(function(e){function o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){var e;return e={startShow:!1,cameraWidth:"100%",cameraHeight:"500px",endShow:!1,submitEnable:!0,endText:"提交",beginText:"开始录制",title:"chooseVideo",classId:""},o(e,"title",""),o(e,"seconds",0),o(e,"stimer",{}),o(e,"showCamera",!0),o(e,"cameraContext",{}),o(e,"maxSeconds",15),o(e,"showProgress",!1),e},computed:{secondfloorper:function(){var e=parseInt(100*(this.seconds/this.maxSeconds).toFixed(2));return e}},onUnload:function(){this.closeCamera(),clearTimeout(this.stimer)},onLoad:function(t){this.cameraContext=wx.createCameraContext(),e.showLoading({title:"相机初始化中..."}),this.classId=t.classId,this.title=t.title;var o=this;e.getSystemInfo({success:function(e){console.log("getSystemInfo:",e),o.cameraHeight=e.windowHeight-50+"px"}})},methods:{closeCamera:function(){this.cameraContext.stopRecord({})},cameraInit:function(t){var o=this;e.showModal({showCancel:!1,title:"提示",content:"进入测评之前将录制一段基准视频，请保证脸部对准摄像头",success:function(){console.log("cameraInit......"),e.hideLoading(),o.startShow=!0}})},error:function(e){console.log(e.detail)},startRecord:function(){var e=this;this.cameraContext.startRecord({success:function(t){console.log("startRecord success:",t),e.submitEnable=!1,e.startShow=!1,e.showProgress=!0,e.videoSecondInc(),setTimeout((function(){e.stopRecord()}),15e3)},fail:function(e){console.log("startRecord fail, ",e)}})},stopRecord:function(){this.seconds=0,this.showProgress=!1,clearTimeout(this.stimer);var t=this,o=e.getStorageSync("userData"),n=e.getStorageSync("projectId");console.log("begin stopRecord=====");try{this.cameraContext.stopRecord({compressed:!0,success:function(s){t.showCamera=!1,e.showLoading({title:"视频分析中"}),console.log("stopRecord success"),wx.uploadFile({url:t.$apis.analysisVideoUrl,filePath:s.tempVideoPath,fileType:"video",name:"file",formData:{classId:t.classId,projectId:n},header:{"Content-Type":"multipart/form-data",userId:o.userId},success:function(o){if(e.hideLoading(),console.log("videoAnalysis success, res is:",o),200==o.statusCode){var n=JSON.parse(o.data);if(200!=n.code)return console.log("healthAnalysisResult error: "+n.msg),e.showToast({title:"服务器异常，请重试",icon:"none"}),t.showCamera=!0,t.submitEnable=!0,void(t.startShow=!0);var s=JSON.parse(o.data).result;if(1==s.healthStatus)return e.setStorageSync("healthAnalysisResult",s.healthAnalysisResult.result),void e.redirectTo({url:"/pages/questions/questions?classId="+t.classId+"&title="+t.title+"&source=1&videoAnalysis=1",success:function(e){console.log(e)},fail:function(e){console.log(e)}})}e.showToast({title:"请确保摄像头对准脸部",icon:"none"}),t.showCamera=!0,t.submitEnable=!0,t.startShow=!0},fail:function(o){t.showCamera=!0,t.submitEnable=!0,t.startShow=!0,e.hideLoading(),console.log("videoAnalysis fail:"+o),e.showModal({content:o.errMsg,showCancel:!1})}})},fail:function(o){console.log("stopRecord fail, ",o),t.submitEnable=!0,t.startShow=!0,e.hideLoading()},complete:function(){console.log("stopRecord complete......")}})}catch(s){console.log("stopRecord error, ",s)}console.log("end stopRecord=====")},videoSecondInc:function(){var e=this;this.stimer=setTimeout((function(){return e.seconds++,e.videoSecondInc()}),1e3)}}};t.default=n}).call(this,o(1)["default"])},176:function(e,t,o){"use strict";o.r(t);var n=o(177),s=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=s.a},177:function(e,t,o){}},[[170,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/review/video.js.map